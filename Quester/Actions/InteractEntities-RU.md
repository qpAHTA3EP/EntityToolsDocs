# **InteractEntities**

Команда предназначена для патрулирования по *HotSpots* в поиске заданного *Entity* и последующего с ним взаимодействия.

## Краткое описание алгоритма команды
1. Бот перемещается между точками *HotSpots* производя поиск ближайшего *Entity*, удовлетворяющего критериям поиска. <br/>
   - Патрулирование может производиться в режиме игнорирования боя [*IgnoreCombat*](#ref-IgnoreCombat).<br/>
   - Область поиска *Entity* может быть ограничена опциями [*CustomRegions*](#ref-CustomRegions),  [*ReactionRange*](#ref-ReactionRange) и [*ReactionZRange*](#ref-ReactionZRange).

2. Когда целевое *Entity* найдено, бот следует к нему по кратчайшему пути.   
   - В отличие от штатной команды *InteractNPC* возможно взаимодействие с движущимися *Entity*.
   - В случае, если взаимодействие прервано нападением противников, оно повторяется после выхода из боя.
   - После завершения взаимодействия или исчерпания попыток, целевая *Entity* временно помещается в черный список для предотвращения повторных безуспешных попыток взаимодействия с ним.
  
3. После исчезновения всех *Entity*, удовлетворяющих критериям поиска, бот возобновляет патрулирование. 


# **Настройки команды**

## **Настройки идентификации *Entity***
Искомое *Entity* задается комбинацией свойств ***EntityID***, ***EntityIdType***, ***EntityNameType***, которые подробно описаны в разделе [Идентификация *Entity*](../../General/EntityIdentification-RU.md)


## **Дополнительные фильтры *Entity* (категория "Optional")**

- <a name ="ref-EntitySetType"></a>***EntitySetType*** - переключатель множества *Entity* среди которых производится поиск:
   + *Contacts* : Только те *Entity* с которыми возможно взаимодействие. Обычно это дружественные *Entity*. Данное множество содержит меньше *Entity* и обрабатывается быстрее;
   + *Complete* : Все множество видимых *Entity*.

- <a name ="ref-ReactionRange"></a>***ReactionRange*** - максимальное допустимое расстояние от *Entity* до персонажа. *Entity* на большем расстоянии игнорируются.<br/>
Опция отключается при установке значения ``0``. При этом поиск производится среди всех видимых боту *Entity*.

- <a name ="ref-ReactionZRange"></a>***ReactionZRange*** - максимальная допустимая разница по высоте (ZAxis) между *Entity* и персонажем. *Entity*, находящиеся выше (ниже) заданной величины относительно персонажа, - игнорируются. <br/>
Опция отключается при установке значения ``0``. При этом поиск производится среди всех видимых боту *Entity*.

- <a name ="ref-RegionCheck"></a>***RegionCheck*** - флаг, активирующий дополнительную проверку внутриигрового региона (не то же самое, что *CustomRegion*), в котором находится *Entity*.
  + *True* : Поиск *Entity* производится в том же регионе, в котором находится персонаж;
  + *False* : Проверка региона при поиске *Entity* не производится.

- <a name ="ref-HealthCheck"></a>***HealthCheck*** - дополнительная проверка уровня здоровья *Entity* (HP).
  + *True* : Игнорируются *Entity* с нулевым количеством очков здоровья (HP) либо, имеющие флаг *IsDead*;
  + *False* : Здоровье *Entity* (HP) не проверяется.

- <a name ="ref-HoldTargetEntity"></a>***HoldTargetEntity*** - флаг удержания *Entity*.
   + *True* : Бот продолжает следовать к ранее найденному *Entity*, даже в том случае, если будет обнаружено *Entity* поближе;
   + *False* : Бот постоянно производит поиск и следует к ближайшему *Entity*.

- <a name ="ref-CustomRegions"></a>***CustomRegions*** - Набор *CustomRegion*'ов, задающих область поиска *Entity*. Подробное описание приведено в разделе [CustomRegionSet](../../General/CustomRegionSet-RU.md).

## **Опции взаимодействия (категория "Interaction")**

- <a name ="ref-InteractTime"></a>***InteractTime*** - время взаимодействия c *Entity* в миллисекундах.

- <a name ="ref-Dialogs"></a>***Dialogs*** - последовательность ответов в окне диалога с *Entity*.

- <a name ="ref-InteractDistance"></a>***InteractDistance*** - минимальное расстояние до *Entity*, на котором с ней можно произвести взаимодействие.

- <a name ="ref-InteractOnce"></a>***InteractOnce*** - флаг, предписывающий выполнять взаимодействие только один раз. Повторное взаимодействие возможно только по истечении времени [InteractingTimeout](#ref-InteractngTimeout).

- <a name ="ref-InteractingTimeout"></a>***InteractingTimeout*** - период времени в секундах, в течение которого повторное взаимодействие с *Entity* запрещено. Опция игнорируется, если не задан флаг [InteractOnce](#ref-InteractOnce).

- <a name ="ref-SkipMoving"></a>***SkipMoving*** - флаг, предписывающий игнорировать движущиеся *Entity*.  
  + *True* : После попытки взаимодействия с движущимся *Entity* он игнорируется;
  + *False* : Попытки взаимодействия производятся независимо от подвижности *Entity* до достижения успеха или до исчерпания лимита.

## **Опции, модифицирующие поведение (категория "Interruptions")**

### **Управление боем**
- <a name ="ref-IgnoreCombat"></a>***IgnoreCombat*** - флаг, предписывающий активировать режим игнорирования боя ***IgnoreCombat*** при следовании к целевой *Entity*.

- <a name ="ref-CombatDistance"></a>***CombatDistance*** - расстояние до целевой *Entity*, на котором отключается режим игнорирования боя ***IgnoreCombat***. <br/>
При установке значения более ``5`` на [Mapper](../../Patches/Mapper/Mapper-RU.md) соответствующая область отображается окружностью, центром которой является соответствующая *Entity*.

### **Прерывание команды**
- <a name ="ref-StopOnApproached"></a>***StopOnApproached*** - флаг, завершающий выполнение команды, после того как персонаж приблизился к целевой *Entity* на расстояние [*Distance*](#ref-Distance) и произвол взаимодействие.

## **Прочие опции**
- <a name ="ref-ResetCurrentHotSpot"></a>***ResetCurrentHotSpot*** - флаг, предписывающий двигаться к ближайшему *HotSpot*'у после исчезновения (взаимодействия) с видимыми целевыми *Entity*.<br/>
Если флаг не установлен бот "запоминате" последний *HotSpot*, к которому двигался перед обнаружением *Entity* и после взаимодействия с ней продолжает движение к нему.


# **Завершение команды**

Команда самостоятельно не завершается, если не задан флаг [*StopOnApproached*](#ref-StopOnApproached).

Принудительное завершение команды возможно одним из [перечисленных в статье способов](./../../General/ForcedQuesterActionTermination-RU.md).


# [Вернуться к содержанию](../../index.md)