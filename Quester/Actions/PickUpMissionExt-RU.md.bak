# **PickUpMissionExt**

Команда предназначена для взятии квестового задания (миссии) у конкретного неигрового персонажа - квестодателя (NPC) или дистанционным способом (Remote).

## **Описание алгоритма**

1. Проверяется отсутствие миссии в журнале активных и выполненных задач персонажа. Если миссия есть в журнале - команда завершается.
2. Если задан квестодатель-NPC, проверяется текущая карта и регион в котором находится персонаж. При несоответствии карты/региона - команда завершается.
3. Персонаж перемещается к квестодателю-NPC и производит взаимодействие с ним, либо активирует дистанционного квестодателя *Remote*.
4. Если задан [*RequiredRewardItem*](#ref-RequiredRewardItem), то проверяется его наличие в составе наград за выполнение миссии, и при его отсутствии - команда завершается.
5. Персонаж принимает миссию и команда завершается.


# **Настройки команды**

## **Обязательные настройки (категория "Required")**
**Название**| **Описание**
:-|:-
<a name ="ref-MissionId">***MissionId***</a> | текстовый идентификатор миссии состоящий из алфавитно-цифровых символов.<br/> В начале и в конце строки допускается использование символа подстановки ``*`` , заменяющего произвольное число алфавитно-цифровых символов.
<a name ="ref-Giver">***Giver***</a> | комплексная опция, идентифицирующая квестодателя, который выдает миссию. <br/> Подробное описание приведено в статье [*MissionGiverInfo*](../../General/MissionGiverInfo-RU.md).
   

## **Настройки взаимодействия (категория "Interaction")**
**Название**| **Описание**
:-|:-
<a name ="ref-Dialogs">***Dialogs***</a> | последовательность ответов в диалоге с квестодателем, которую необходимо пройти перед получением возможности принять миссию. Опция не обязательна.
<a name ="ref-InteractDistance">***InteractDistance***</a> | максимальное допустимое расстояние, на котором возможно взаимодейтсвие с квестодателем-NPC.
<a name ="ref-SkipOnFail">***SkipOnFail***</a> | флаг, предписывающий завершить команду после безуспешной попытки принять заданную миссию.
<a name ="ref-ReactionZRange">***ReactionZRange***</a> | максимальная допустимая разница по высоте (ZAxis) между квестодателем-NPC и персонажем. <br/> Минимальное допустимое значение ``5``.
<a name ="ref-CloseContactDialog">***CloseContactDialog***</a> | флаг, предписывающий закрывать диалог с квестодателем после взятия миссии. По умолчанию не установлен.

## **Дополнительные опции  (категория "Options")**
**Название**| **Описание**
:-|:-
<a name ="ref-ContactHaveMission">***ContactHaveMission***</a> | Переключатель, активирующий проверку на наличие у квестодателя-NPC квестового задания:<table><tr><td>Any</td><td>любой тип миссии (значение по умолчанию)</td></tr><tr><td>Main</td><td>миссия, относящаяся к Приключению (Adventure)</td></tr><tr><td>Repeatable</td><td>повторяемая миссия (дейлик)</td></tr><tr><td>Disable</td><td>проверка отключена</td></tr></table> Активация данной опции позволяет исключить лишние перемещения персонажа, поскольку позволяет определить отсутствие у квестодателя-NPC миссии не приближаясь к нему в плотную и не выполняя взаимодействия.<br/> Следует отметить, что проверка будет работать некорректно, если иконка над персонажем отличается от стандартных иконок квестовых заданий, например, иконка магазина.
<a name ="ref-IgnoreCombat">***IgnoreCombat***</a> | Флаг, предписывающий активировать режим игнорирования боя *IgnoreCombat* при следовании к квестодателю-NPC.<br/> Режим игнорирования боя отключается только при [штатном завершении команды](#завершение-команды). В случае [принудительного прерывания команды](./../../General/ForcedQuesterActionTermination-RU.md) режим игнорирования боя может продолжать действовать и влиять на выполнение quester-профиля.
<a name ="ref-RequiredRewardItem">***RequiredRewardItem***</a> | Идентификатор предмета, который должен быть в наградах за выполнение миссии. Пустая строка отключает проверку.<br/>Миссия не будет принята при отсутствии заданного предмета. <br/>В начале и в конце строки допускается использование символа подстановки ``*`` , заменяющего произвольное число алфавитно-цифровых символов.<br/>Чтобы выбрать нужный предмет в игре должно быть открыто диалоговое окно принятия миссии.


# **Мастер настройки (GatherInfo)**

Мастер настройки вызывается автоматически при добавлении новой команды, или при нажатии кнопки **[GatherInfo]**. Для настройки команды выполните следующие действия: 
1. В quester-редакторе в диалоговом окне ***SelectForm***  выберите [типа квестодателя](./../../General/MissionGiverInfo-RU.md#ref-Type):
   - *NPC* : неигровой персонаж-квестодатель, расположенный в определенном месте игрового мира;
   - *Remote* : дистанционная диалоговая система, доступная из любой точки игрового мира. Обычно с таких миссий начинаются кампании.<br/>
   ![Выбор типа квестодателя](./img/PickUpMissionExt-GatherInfo-GiverTypeSelection.png)
2. Идентифицируйте квестодателя.
   - Идентификация квестодателя-*NPC* производится в игровом окне. Для этого нужно подвести игрового персонажа вплотную к соответствующему *NPC*, направить на него игровую камеру и нажать F12.<br/> 
   ![Идентификация квестодателя-NPC](./img/PickUpMissionExt-GatherInfo-GiverIdentification.png)
   - Идентификация дистанционного квестодателя (*Remote*) производится в диалоговорм окне ***GetAnId*** в quester-редакторе.<br/>
   ![Выбор Remote-квестодателя](./img/PickUpMissionExt-GatherInfo-RemoteGiverSelection.png)<br/>
   После идентификации квестодателя-NPC игровой персонаж самостоятельно произведет взаимодействие с ним и дождётся появления внутриигрового диалогового окна.
3. В окне quester-редактора в диалоговом окне ***GetAnId*** выбрите пункт диалога, соответствующий принимаемому квестовому заданию.<br/>
   ![Выбор диалога](./img/PickUpMissionExt-GatherInfo-Dialogs.png)<br/>
Если закрыть окно ***GetAnId*** без выбора пункта диалога - откроется стандартное окно выбора миссии.<br/>
После выбора пункта диалога в редакторе, бот активирует в игре соответствующий пункт диалога, что приводит к открытию экрана принятия миссии. На этом этапе возможно подвисание до 3 секунд, связанное с необходимостью "ожидания отклика" игрового интерфейса и обновления игрового журнала заданий.<br/>
Бот попытается самостоятельно извлечь идентификатор миссии [*MissionId*](#ref-MissionId).
4. Если боту не удалось извлечь идентификатор миссии [*MissionId*](#ref-MissionId), в quester-редакторе отобразится диалоговое окно ***Get a mission id***, в котором необходимо выбрать нужную миссию.<br/> 
![Выбор MissionId вручную](img/PickUpMissionExt-GatherInfo-ManualMissionId.png)
5. В quester-редакторе в диалоговом окне ***Get an item id***, можно выбрать один из предметов, выдаваемых в качестве награды за выполнение миссии. <br/>
По умолчанию открывается вкладка с наградами за выполнение миссии, однако, для поиска нужного предмета можно переключиться другую вкладку. <br/>
Идентификатор выбранной награды заносится в опцию [*RequiredRewardItem*](#ref-RequiredRewardItem). <br/>
Если закрыть окно, то опция [*RequiredRewardItem*](#ref-RequiredRewardItem) останется незаполненной, а проверка - отключится.<br/>
![Выбор RequiredRewardItem](img/PickUpMissionExt-GatherInfo-RequiredRewardItem.png)



# **Завершение команды**

Команда завершается:
- если персонаж и квестодатель-NPC находятся на разных картах, или в разных регионах;
- если необходимая миссия содержится в журнале активных или завершенных задач персонажа;
- после взаимодействия с квестодателем и принятия заданной миссии;
- при отсутствии [*RequiredRewardItem*](#ref-RequiredRewardItem) в списке наград за выполнение миссии.
 
Принудительное завершение команды возможно одним из [перечисленных в статье способов](./../../General/ForcedQuesterActionTermination-RU.md).


# **Штатные команды - аналоги и их отличие**

Отличия от штатных команд ***PickUpMission*** и ***InteractNPC***:
+ возможность проверки наличия в наградах за миссию заданного [предмета](#ref-RequiredRewardItem "Опция 'RequiredRewardItem'") и отказ от принятия миссии при его отсутствии. <br/>  
+  встроенная проверка наличий миссии в журнале активных или завершенных задач персонажа;
+  встроенная проверка [карты](#ref-MapName "Опция 'MapName'") и [региона](#ref-RegionName "Опция 'RegionName'"), в которых находится квестодатель-NPC. Команда прерывается, если персонаж находится на иной карте или в ином регионе;
+  возможность активировать режим [игнорирования боя](#ref-IgnoreCombat "Опция 'IgnoreCombat'");
+  встроенная проверка наличия квестовых заданий у заданного квестодателя-NPC [*ContactHaveMission*](#ref-ContactHaveMission "Опция 'ContactHaveMission'");
+  удобный [мастер настройки (GatherInfo)](#мастер-настройки-gatherinfo) 


# [Вернуться к содержанию](../../index.md)