@startuml
!theme spacelab
skinparam DefaultTextAlignment Center

'skinparam BackgroundColor White

start

repeat

'partition "Поиск" {
    while (Target отсутствует\nИЛИ\nИстек Timeout повторного поиска?) is (<color:black>да)

        :Поиск ближайшего Entity\n(ClosestEntity)|
        :Обновить Timeout]
        if (ClosestEntity найдено?) then (<color:black>да) 
            if (Флаг HoldTargetEntity = True ?) then (<color:black>да) 
            else (<color:black>нет)
                :Target := ClosestEntity|
            endif 
            if (Расстояние до ClosestEntity\nменьше CombatDistance ?) then (<color:black>да)
                (А)
            else (<color:black>нет)
                break
            endif
        else (<color:black>нет)
            if (Флаг IgnoreCombat = True ?) then (<color:black>да) 
                :Установка запрета боя]
            else (<color:black>нет)
            endif
        endif
        ' if (Target отсутствует ?) then (<color:black>нет) 
        '     break
        ' else (<color:black>да)
        ' endif
        :Перемещение к\nследующему HotSpot|
    endwhile (<color:black>нет)
'}

'partition "Перемещение" {
if (Расстояние до Target\nбольше CombatDistance ?) then (<color:black>да)
    if (Флаг IgnoreCombat = True ?) then (<color:black>да) 
        :Установка запрета боя]
    else (<color:black>нет)
    endif
    :Перемещение к Target|
else (<color:black>нет)
endif
'}

(А)

'partition "Бой" {
if (Флаг IgnoreCombat = True\nИ\nAbortCombatDistance > CombatDistance) then (<color:black>да) 
    :Установить тригер\nпрерывания боя\nв случае превышения\nAbortCombatDistance]
else (<color:black>нет)
endif

:Снять запрет боя]
if (Флаг АttackTargetEntity = True ?) then (<color:black>да)
    :Атаковать ClosestEntity|
    :Атаковать Target|
else (<color:black>нет)
    :Атаковать произвольного\nврага|
endif
'}

repeat while (Флаг StopOnApproached = False ?) is (<color:black>да) 

stop

@enduml